(window.webpackJsonp=window.webpackJsonp||[]).push([[165],{"3GUV":function(e,t,n){"use strict";var i=n("ERkP"),s=n("rHpw"),r=n("MWbm");class o extends i.Component{shouldComponentUpdate(){return!1}render(){return i.createElement(r.a,{style:a.root})}}const a=s.a.create((e=>({root:{height:5*e.lineHeightsPx.body}})));t.a=o},"5UID":function(e,t,n){"use strict";var i=n("ERkP"),s=n("3XMw"),r=n.n(s),o=n("rHpw"),a=n("+/1j"),c=n("MWbm");const l=r.a.e5b0063d;let h=0;class d extends i.Component{constructor(){super(),this._listDomId=`accessible-list-${h}`,h+=1}render(){const{children:e,title:t}=this.props,n=l({title:t});return i.createElement(c.a,{accessibilityLabelledBy:this._listDomId,accessibilityRole:"region"},i.createElement(a.a,{accessibilityLevel:1,accessibilityRole:"heading",nativeID:this._listDomId,style:o.a.visuallyHidden},t),i.createElement(c.a,{accessibilityLabel:n},e))}}t.a=d},JsJV:function(e,t,n){"use strict";var i=n("6/RC"),s=n("tI3i"),r=n.n(s),o=i.canUseDOM?window.location.href:"",a=function(){function e(){var e=this;this._eventCallbacks={},this.addEventListener=function(t,n){e._eventCallbacks[t]?e._eventCallbacks[t].push(n):e._eventCallbacks[t]=[n]},this.removeEventListener=function(t,n){var i=e._eventCallbacks[t].filter((function(e){return e.toString()!==n.toString()}));e._eventCallbacks[t]=i}}var t=e.prototype;return t._dispatchEvent=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var s=this._eventCallbacks[e];null!=s&&Array.isArray(s)&&s.map((function(e){e.apply(void 0,n)}))},t.canOpenURL=function(){return Promise.resolve(!0)},t.getInitialURL=function(){return Promise.resolve(o)},t.openURL=function(e){try{return c(e),this._dispatchEvent("onOpen",e),Promise.resolve()}catch(e){return Promise.reject(e)}},t._validateURL=function(e){r()("string"==typeof e,"Invalid URL: should be a string. Was: "+e),r()(e,"Invalid URL: cannot be empty")},e}(),c=function(e){if(i.canUseDOM){var t=new URL(e,window.location).toString();window.open(t,"_blank","noopener")}};t.a=new a},VeNJ:function(e,t,n){"use strict";n.r(t),n.d(t,"TimelineRenderer",(function(){return ie}));var i=n("KEM+"),s=n.n(i),r=(n("kYxP"),n("ejT/")),o=n("ERkP"),a=n("5UID"),c=n("6/RC"),l=n("1YZw"),h=n("rxPX"),d=Object(h.a)().propsFromActions((()=>({addToast:l.b}))).withAnalytics(),p=n("KNCp"),m=n("lUZE");var u=Object.freeze({Icon:"Icon",IconSmall:"IconSmall",FullWidth:"FullWidth"}),_=n("caTy"),b=n("TnY3"),y=n("TIdA"),v=n("A91F"),g=n("feu+"),f=n("JsJV"),C=n("MWbm"),w=n("oQhu"),E=n("fs1G"),I=n("rcen");class T extends o.PureComponent{constructor(...e){super(...e),s()(this,"_getGraphicProps",Object(w.a)(((e,t)=>{const n=e?({style:t})=>o.createElement(C.a,{style:t},o.createElement(y.a,{accessibilityLabel:"",aspectMode:v.a.exact(e.width/e.height),image:e})):m.a;let i="illustration";return e&&t!==u.IconSmall?t===u.FullWidth&&(i="illustrationFullWidth"):i="icon",{graphic:n,graphicDisplayMode:i}}))),s()(this,"_scribeAction",((e,t)=>{const{analytics:n}=this.props,{action:i,component:s,element:r}=t||{};n.scribe({action:i||e,component:s||"cover",element:r})})),s()(this,"_handleDismiss",(()=>{const{dismissInfo:e,processCallback:t}=this.props,{callbacks:n}=e||{};n&&n.forEach((e=>{t(e)})),e&&(this._scribeAction("dismiss"),this.props.onClose())})),s()(this,"_handlePrimaryCtaClick",(()=>{this._handleCtaClick(this.props.primaryCta,"primary_cta")})),s()(this,"_handleSecondaryCtaClick",(()=>{this.props.secondaryCta&&this._handleCtaClick(this.props.secondaryCta,"secondary_cta")})),s()(this,"_handleCtaClick",(({ctaBehavior:e,callbacks:t,clientEventInfo:n},i)=>{const{addToast:s,processCallback:r,history:o}=this.props;if(this.props.onClose(),this._scribeAction("click",{element:i,...n}),e.dismiss){const{dismiss:t}=e;t&&t.feedbackMessage&&s({text:t.feedbackMessage.text})}if(e.navigate){const{navigate:t}=e,n=t&&Object(_.b)(t.url);n&&(n.external?f.a.openURL(n.pathname):o.push(n.pathname))}t&&t.forEach((e=>r(e)))}))}componentDidMount(){this.props.onImpression&&this.props.onImpression()}render(){const{image:e,imageDisplayType:t,primaryText:n,primaryCta:i,secondaryText:s,secondaryCta:r,details:a,displayType:c,type:l,dismissInfo:h}=this.props,d=o.createElement(I.b,{entities:n.entities,text:n.text}),m=s?o.createElement(I.b,{entities:s.entities,text:s.text}):null;if(l===p.a.Full){const l=a?o.createElement(I.b,{entities:a.entities,text:a.text}):null,{graphic:p,graphicDisplayMode:u}=this._getGraphicProps(e,t);return o.createElement(g.a,{actionLabel:i.text,footer:l,footerAlign:a&&a.alignment===I.a.Center?"center":"left",graphic:p,graphicDisplayMode:u,headline:d,headlineAlign:n.alignment===I.a.Natural?"left":"center",isFullHeightOnMobile:!h&&"CenterCover"!==c,onAction:this._handlePrimaryCtaClick,onClose:this._handleDismiss,onTertiaryAction:this._handleSecondaryCtaClick,subtext:m,subtextAlign:s&&s.alignment===I.a.Natural?"left":"center",tertiaryActionLabel:r&&r.text,withCloseButton:!!h})}return o.createElement(g.a,{actionLabel:i.text,graphicDisplayMode:"none",headline:d,headlineAlign:n.alignment===I.a.Center?"center":"left",onAction:this._handlePrimaryCtaClick,onClose:E.a,onSecondaryAction:this._handleSecondaryCtaClick,secondaryActionLabel:r&&r.text,subtext:m,subtextAlign:s&&s.alignment===I.a.Center?"center":"left",withCloseButton:!1})}}s()(T,"defaultProps",{imageDisplayType:u.Icon});var k=Object(b.a)(d(T));const S={component:"cover",action:"impression"};var R=({activeCover:e,clearActiveCover:t,processCallback:n,scribeAction:i,scribeNamespace:s})=>{const r=((e,t)=>{let n={...e,...S};return t&&(n={...n,component:t.component||n.component,element:t.element||n.element,action:t.action||n.action}),n})(s,e.clientEventInfo),a=()=>{const{cover:{impressionCallbacks:t}}=e;t&&t.forEach((e=>n(e))),i(r)};return"full"===e.type?(c=e.cover,o.createElement(k,{details:c.details||void 0,dismissInfo:c.dismissInfo,displayType:c.displayType,image:c.image,imageDisplayType:c.imageDisplayType||void 0,onClose:t,onImpression:a,primaryCta:c.primaryCoverCta,primaryText:c.primaryText,processCallback:n,secondaryCta:c.secondaryCoverCta,secondaryText:c.secondaryText,type:"full"})):"half"===e.type?function(e){const i="CenterCover"===e.displayType?"full":"half";return o.createElement(k,{displayType:e.displayType,image:e.coverImage?e.coverImage.image:void 0,imageDisplayType:e.coverImage?e.coverImage.imageDisplayType:void 0,onClose:t,onImpression:a,primaryCta:e.primaryCoverCta,primaryText:e.primaryText,processCallback:n,secondaryCta:e.secondaryCoverCta,secondaryText:e.secondaryText,type:i})}(e.cover):null;var c},x=n("MDbM"),A=(n("C1yv"),n("FvOC")),L=n("Stgo"),D=n("LFzM");var M=({children:e,impressionTracker:t})=>t?o.createElement(D.a.Provider,{value:{impressionTracker:t}},e):e,N=n("VPAj"),P=n("3GUV"),O=n("v//M"),U=n("rHpw");const V=Object(N.a)(o.createElement(P.a,null)),F=({bottomFetchStatus:e,onBottomRetry:t})=>o.createElement(C.a,{style:B.footer},o.createElement(O.a,{fetchStatus:e,onRequestRetry:t,render:V})),B=U.a.create((e=>({footer:{height:`calc(5 * ${e.lineHeights.body})`}})));var j=o.memo(F),H=n("xjVt"),W=n("EUHl"),G=n("IG4P"),K=n("iBK2"),z=(n("rxtR"),n("pbku")),J=n("aITJ"),q=n("aWzz"),Y=n("iChn"),Q=n("Qyxo"),X=n("8UdT"),Z=n("cFgU");const $=e=>e.entryId,ee=e=>e.sortIndex;const te=new Map,ne=e=>{switch(e){case X.b.Tweet:return J.b.isDesktopOS()?250:400;case X.a.ModuleImpressionPlaceholder:return 0;default:return 100}};class ie extends o.PureComponent{constructor(e,t){var n;super(e,t),s()(this,"_promotedTweetDistanceMap",new Map),s()(this,"_renderLoadBottom",(()=>{const{bottomFetchStatus:e,onBottomRetry:t}=this.props;return o.createElement(j,{bottomFetchStatus:e,onBottomRetry:t})})),s()(this,"_refreshControlWrapper",(e=>{const{canRefresh:t,refreshControl:n,topFetchStatus:i,onRefresh:s}=this.props;return n?o.createElement(n,{canRefresh:t,isRefreshing:i===x.a.LOADING,onRefresh:s},e):e})),s()(this,"_getCellRenderer",Object(w.a)(((e,t)=>{let n;const i={module:t,renderEntry:e=>n(e)};return n=(t,n)=>{const s=e.getHandler(t);return s&&s.render?s.render(t,i,n):null},n}))),s()(this,"_getInitialFocusedEntry",Object(w.a)(((e,t)=>t&&e.find(t)))),s()(this,"_createEntryIndex",Object(w.a)((e=>Object(Y.a)(e,(e=>e.entryId))))),s()(this,"_handleBeforeWindowUnload",(()=>{this._flushLingerScribes()})),s()(this,"_handleKeyboardRefresh",(()=>{this.refreshOrGoTop(!0)})),s()(this,"scrollToTop",(e=>{this._scroller&&this._scroller.scrollToNewest(e)})),s()(this,"_handleAtBottom",this._proximityHandler((()=>{this.props.onAtBottom&&this.props.onAtBottom()}))),s()(this,"_handleNearBottom",this._proximityHandler((()=>{this.props.onNearBottom()}))),s()(this,"_handleNearTop",this._proximityHandler((()=>{const{onNearTop:e}=this.props;e()}))),s()(this,"_handleAtTop",this._proximityHandler((()=>{const{onAtTop:e,removeAlert:t,richScribeAction:n,scribeNamespace:i}=this.props;t&&t(),e&&e();n({...i,component:"stream",element:"top",action:"show"})}))),s()(this,"_handleItemsRendered",this._proximityHandler((({viewport:e,positions:t})=>{if(this.props.onEntriesRendered&&this.props.onEntriesRendered(),!this._V2ImpressionsEnabled()){const{lingers:n,impressions:i}=this._impressionTracker.processPositioningUpdate(t,e);this._scribeLingerEvents(n.scribeLingerEvents),this._handleOnLingerEvents(n.allLingerIds),this._scribeImpressionEvents(i)}}))),s()(this,"_scribeImpressionEvents",(e=>{var t;const n=this._getEntryIndex(),i=null==(t=this.context.featureSwitches)?void 0:t.isTrue("responsive_web_element_size_impression_scribe_enabled"),s=Object(Q.a)(e,(e=>{const t=n[e.id];return null!=t?{entry:t,relativeElementHeight:i?e.relativeElementHeight:void 0}:null}));this._scribeNewEntries(s)})),s()(this,"_handleProcessLingerAndImpressionEvents",(()=>{if(this._impressionTrackerV2){var e;const t=this._impressionTrackerV2.getLingerEvents();this._scribeLingerEvents(t);const n=(null==(e=this._impressionTrackerV2)?void 0:e.getImpressionEvents())||[];this._scribeImpressionEvents(n)}})),s()(this,"_handleOnLingerEvents",(e=>{e.forEach((e=>this._handleOnLingerEvent(e)))})),s()(this,"_handleOnLingerEvent",(e=>{const{applyReactionInstructions:t}=this.props,n=this._getEntryIndex()[e];n&&t({entry:n,triggerName:z.a.ON_LINGER})})),s()(this,"_handlePositionRestored",(()=>{this._positionedRestored=!0})),s()(this,"_scheduleNewEntriesScribing",(n=e=>{const{richScribeAction:t,scribeNamespace:n}=this.props,i=this._buildStreamScribeData(e);i.length>0&&t({...n,component:"stream",action:"results"},{items:i})},c.canUseDOM&&window.requestIdleCallback?e=>{const t=window.requestIdleCallback((()=>n(e)));return()=>window.cancelIdleCallback(t)}:c.canUseDOM&&window.requestAnimationFrame?e=>{const t=window.requestAnimationFrame((()=>n(e)));return()=>window.cancelAnimationFrame(t)}:()=>E.a)),s()(this,"_setScroller",(e=>{this._scroller=e})),s()(this,"_V2ImpressionsEnabled",(()=>{var e;return c.canUseDOM&&(null==(e=this.context.featureSwitches)?void 0:e.isTrue("responsive_web_linger_refactor_enabled"))})),s()(this,"_newImpressionTrackerV2",(()=>this._V2ImpressionsEnabled()&&window.IntersectionObserver?new L.a({root:this.context.viewport.getViewport(),reactivityCallback:this._handleOnLingerEvent}):void 0)),this._impressionTracker=new A.a,this._streamScribeCancelCallbacks=[],this._impressionTrackerV2=this._newImpressionTrackerV2()}UNSAFE_componentWillReceiveProps(e){this.props.timelineId!==e.timelineId&&(this._flushLingerScribes(),this._impressionTracker=new A.a,this._impressionTrackerV2&&this._impressionTrackerV2.disconnect(),this._impressionTrackerV2=this._newImpressionTrackerV2())}componentDidMount(){const{onRef:e}=this.props;this._initialize(),window.addEventListener("beforelogout",this._handleBeforeWindowUnload),window.addEventListener("beforeunload",this._handleBeforeWindowUnload),e&&e(this)}componentWillUnmount(){var e;const{onRef:t}=this.props;this._flushLingerScribes(),this._cancelStreamScribeCallbacks(),window.removeEventListener("beforelogout",this._handleBeforeWindowUnload),window.removeEventListener("beforeunload",this._handleBeforeWindowUnload),t&&t(void 0),null==(e=this._impressionTrackerV2)||e.disconnect()}componentDidUpdate(e){const{entries:t,handlerRegistry:n,timelineId:i,onRef:s}=this.props;i!==e.timelineId?this._initialize():t===e.entries&&n===e.handlerRegistry||this._initialize(),s&&s!==e.onRef&&s(this)}render(){const{anchoring:e,entries:t,handlerRegistry:n,showFooter:i,header:s,isInitialFocusEntry:c,nearStartProximityRatio:l,renderEmptyState:h,timelineId:d,title:p,module:m,withKeyboardShortcuts:u}=this.props,_=this.props.scroller,b=this._getInitialFocusedEntry(t,c),y=this._V2ImpressionsEnabled()?this._handleProcessLingerAndImpressionEvents:E.a;return this._refreshControlWrapper(this._shouldRenderEmptyState(t)?h():o.createElement(M,{impressionTracker:this._impressionTrackerV2},o.createElement(a.a,{title:p},this._renderActiveCover(),this._renderPill(),o.createElement(_,{anchoring:e,assumedItemHeight:ne,cacheKey:d,footer:i&&this._renderLoadBottom(),header:s,identityFunction:$,initialAnchor:b&&r.b($(b)),items:t,nearStartProximityRatio:l,onAtEnd:this._handleAtBottom,onAtStart:this._handleAtTop,onItemsRendered:this._handleItemsRendered,onKeyboardRefresh:this._handleKeyboardRefresh,onNearEnd:this._handleNearBottom,onNearStart:this._handleNearTop,onPositionRestored:this._handlePositionRestored,onScrollEnd:y,ref:this._setScroller,renderer:this._getCellRenderer(n,m),sortIndexFunction:ee,withKeyboardShortcuts:u}))))}_renderPill(){const{alert:e,removeAlert:t,topUnseenCount:n,newTweetsPillLabel:i,newTweetsPillMode:s,scribeNamespace:r,timelineId:a}=this.props;return s?s===W.a.URT?o.createElement(H.a.Configure,{alert:e,label:i,removeAlert:t,scribeNamespace:r,timelineId:a}):s===W.a.CLIENT&&n&&n>0?o.createElement(H.a.Configure,{removeAlert:t,scribeNamespace:r,timelineId:a,unreadCount:n}):void 0:null}_renderActiveCover(){const{activeCover:e,clearActiveCover:t,processCallback:n,scribeAction:i,scribeNamespace:s}=this.props,r=e&&e.cover;return e&&r?o.createElement(R,{activeCover:e,clearActiveCover:t,processCallback:n,scribeAction:i,scribeNamespace:s}):null}_shouldRenderEmptyState(e){const{activeCover:t,initialFetchStatus:n}=this.props,i=n===x.a.LOADED,s=0===e.length;return i&&s&&!t}_getEntryIndex(){return this._createEntryIndex(this.props.entries)}_initialize(){this._createPromotedTweetDistanceMap()}_createPromotedTweetDistanceMap(){const{entries:e}=this.props;this._promotedTweetDistanceMap=new Map;let t=null;e.forEach((e=>{var n;let i=!1;null!=(n=e.content)&&n.promotedMetadata&&(i=e.content.promotedMetadata),i&&null!==t&&this._promotedTweetDistanceMap.set(e.entryId,t),i?t=0:null!==t&&-1===e.type.indexOf("ui_")&&(t+=1)}))}_flushLingerScribes(){const e=this._impressionTrackerV2?this._impressionTrackerV2.flushLingerEvents():this._impressionTracker.flushLingerEvents();this._scribeLingerEvents(e)}refreshOrGoTop(e){this._scroller&&!this._scroller.isAtNewest()?this.scrollToTop(e):this.props.onRefresh()}_proximityHandler(e){return t=>{this._positionedRestored&&e(t)}}_scribeNewEntries(e){const t=this._scheduleNewEntriesScribing(e);for(this._streamScribeCancelCallbacks.push(t);this._streamScribeCancelCallbacks.length>=20;)this._streamScribeCancelCallbacks.shift()}_buildStreamScribeData(e){const{scribeCache:t,timelineId:n,handlerRegistry:i}=this.props;if(!t.has(n)){const e=new Set;t.set(n,e)}const s=t.get(n);return s?e.reduce(((e,t,n)=>{const{entry:r,relativeElementHeight:o}=t,{entryId:a}=r;if(!s.has(a)&&!i.getNeedsLoad(r)){s.add(a);const t=this._getScribeDataItem(i,r);if(t){var c;const n=!(null==(c=r.content)||!c.promotedMetadata),i=this._promotedTweetDistanceMap.get(a);n&&i&&(t.tweet_count=i),null!=o&&(t.percent_screen_height_100k=o),e.push(t)}}return e}),[]):[]}_storeSeenIds(e){const{seenIds:t,seenIdsLatest:n,timelineId:i}=this.props;"home"===i&&t?t.addNewTweets(e):"home-latest"===i&&n&&n.addNewTweets(e)}_scribeLingerEvents(e){if(0===e.length)return;const{handlerRegistry:t}=this.props,n=this._getEntryIndex(),i=[],s=[];if(e.forEach((({id:e,start:r,end:o})=>{const a=n[e];if(a){const e=this._getScribeDataItem(t,a);if(e){const t={visibility_start:r,visibility_end:o};i.push({...e,impression_details:t})}a.type===X.b.Tweet&&s.push(a.content.id)}})),i.length>0){const{richScribeAction:e,scribeNamespace:t}=this.props;e({...t,component:"stream",element:"linger",action:"results"},{items:i})}s.length>0&&this._storeSeenIds(s)}_getScribeDataItem(e,t){const n=e.getHandler(t);if(n)return n.getScribeDataItem(t)}_cancelStreamScribeCallbacks(){this._streamScribeCancelCallbacks.forEach((e=>e()))}}s()(ie,"contextTypes",{viewport:q.object,featureSwitches:q.any}),s()(ie,"defaultProps",{onBottomRetry:E.a,onNearBottom:E.a,onNearTop:E.a,onRefresh:E.a,refreshControl:G.a,scribeCache:te,scroller:K.b,seenIds:Object(Z.b)(),seenIdsLatest:Object(Z.a)(),showFooter:!0,withKeyboardShortcuts:!0});t.default=ie},"ejT/":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return s}));const i=e=>({id:e,distanceToViewportTop:0}),s=e=>({id:e,distanceToViewportBottom:0})}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/loader.TimelineRenderer.30108ea5.js.map
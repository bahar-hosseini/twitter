(window.webpackJsonp=window.webpackJsonp||[]).push([[188],{"38Al":function(t,e,i){"use strict";var s=i("ERkP"),a=i("rHpw"),r=i("MWbm");const n=t=>{t.preventDefault(),t.stopPropagation()};e.a=({children:t,testID:e})=>s.createElement(r.a,{onClick:n,style:a.a.absoluteFill,testID:e},t)},"64vW":function(t,e,i){"use strict";var s=i("ERkP");const a=s.createContext({heightsReady:!0});e.a=a},QHXq:function(t,e,i){"use strict";i.r(e),i.d(e,"InlinePlayerContainer",(function(){return G}));var s=i("97Jx"),a=i.n(s),r=i("KEM+"),n=i.n(r),o=i("ERkP"),l=i("6rlp"),c=i("H9MA"),h=i("RqPI"),p=i("yr4d"),d=i("XOJV"),u=i("rxPX"),_=i("0KEI"),y=i("eXeu");const m=()=>(t,e,{api:i})=>i.getHttpClient(),b=(t,e)=>{const i=e.source&&e.source.videoId;return i&&"tweet"===i.type?i.id:void 0};var P=Object(u.a)().propsFromState((()=>({dataSaverMode:c.c,language:h.n,sourceTweet:d.a.createHydratedTweetSelector(b)}))).adjustStateProps((({dataSaverMode:t,language:e,sourceTweet:i})=>({dataSaverMode:t,language:e,mediaAvailability:i&&Object(y.b)(i)||void 0,publisherId:i?Object(y.c)(i):void 0}))).propsFromActions((()=>({createLocalApiErrorHandler:Object(_.d)("INLINE_PLAYER_CONTAINER"),getTwitterAuthedHttpClient:m,logPromotedVideoEvent:l.b,tweetAdProvider:p.b}))).withAnalytics(),g=i("6v1f"),v=i("ZeN/"),I=i("38Al"),f=i("epkG"),C=i("mN6z"),A=(i("u+Xj"),i("ylrv"));class w{constructor(t,e,i){this.placement=t,this.obstructions=e,this.layerId=i}getPositionData(){return{percentVisible:this.visibleFraction(),percentOfViewportOccupied:this.placement.viewportOccupiedFraction(),sizesInfo:{viewportSize:this.placement.viewport,mediaSize:this.placement.item}}}visibleFraction(){const t=this.placement.visiblePart();if(!t)return 0;const e=this.layerId?this.obstructions.getObstructionAboveLayer(this.layerId,t):this.obstructions.getTotalObstruction(t),i=A.a.area(this.placement.item),s=(1-e)*A.a.area(t);return i>0?s/i:0}top(){return this.placement.item.top}distanceToCenter(){return this.placement.verticalDistanceToViewportCenter()}distanceToTop(){return this.placement.verticalDistanceToViewportTop()}scrollY(){return this.placement.scrollY}}i("kYxP");var S=i("gZV8"),E=i("vF3p"),R=i("S4UJ");class T extends o.Component{constructor(...t){super(...t),n()(this,"_handlePlacementChange",(t=>{this._updateAndNotify({placement:t},this.props.onChange)})),n()(this,"_handleObstructionChange",(()=>{const{obstructionDetection:t,onChange:e}=this.props;this._updateAndNotify({obstructions:t.getObstructions()},e)})),n()(this,"_setPlacementRef",(t=>{this._placementRef=t}))}sample(t){this._placementRef&&this._placementRef.sample((e=>{this._updateAndNotify({placement:e},t)}))}render(){const{children:t,style:e}=this.props;return o.createElement(S.a,{onPlacementChange:this._handlePlacementChange,ref:this._setPlacementRef,style:e,withIntersectionObserver:!0},t)}componentDidMount(){const{obstructionDetection:t}=this.props;this._obstructionSubscription=t.subscribe(this._handleObstructionChange)}componentWillUnmount(){this._obstructionSubscription&&(this._obstructionSubscription.unsubscribe(),this._obstructionSubscription=void 0)}_updateAndNotify({placement:t,obstructions:e},i){const{layerId:s,obstructionDetection:a}=this.props;this._placement=t||this._placement,this._obstructions=e||this._obstructions||a.getObstructions(),this._placement?i(new w(this._placement,this._obstructions,s)):this._placementRef&&this._placementRef.sample((t=>{this._placement=t,this._obstructions=this._obstructions||a.getObstructions(),i(new w(t,this._obstructions,s))}))}}n()(T,"defaultProps",{obstructionDetection:E.a});var k=Object(R.a)(T),F=i("efbI"),O=i("mf9H"),H=i("zHh/"),M="videoPlayer",x=i("v/3V"),L=i("aITJ"),D=i("Xq8B"),V=i("Zl35"),j=i("9Xij"),U=i("rHpw"),N=i("HT/6"),z=i("v6aA"),q=i("iOGT");const X=new f.a({});class B extends o.Component{constructor(t,e){super(t,e),n()(this,"_emitter",null),n()(this,"_playerInternal",null),n()(this,"_placementRef",null),n()(this,"_isLooping",!1),n()(this,"_isPlayerFullscreen",!1),n()(this,"_renderHorizonPlayer",(t=>{const{accessibilityLabel:e,analytics:i,aspectRatio:s,source:{contentId:r,eventId:n,videoId:l,vmapUrl:c},displayOptions:h,durationMs:p,intentToPlayTime:d,playerId:u,videoEl:_,viewCount:y,includeBroadcastEventAssociation:m,geolocationPrompt:b,timecode:P,mediaAvailability:g,noAuthHttpClient:v,publisherId:I,twitterAuthedHttpClient:f,language:C,videoPlayer:A,uiStack:w}=this.props;return o.createElement(F.a.Consumer,null,(({prerollDisplayLocation:S})=>o.createElement(V.b,a()({accessibilityLabel:e,adProvider:this._tweetAdProvider(S),analytics:i,aspectRatio:s,basePlayerClass:A,configType:"static",contentId:r,cta:this._getPlayerCTA(),disableHls:this._disableHls,durationMs:p,enableVideoPlayerCaptionRendering:!0,eventId:n,featureProvider:this.context.featureSwitches,geolocationPrompt:b,httpClient:v,includeBroadcastEventAssociation:m,initiallyMutedCaptions:!0,intentToPlayTime:d,language:C,mediaAvailability:g,objectFitVideo:h&&h.objectFitVideo,onApiReady:this._handleApiReady,playbackSessionId:l.id,playerId:u,precache:this._shouldAutoplay,publisherId:I,requestedTimecode:P,twitterAuthedHttpClient:f,videoEl:_,videoId:l,viewCount:y,vmapUrl:c},t),w)))})),n()(this,"_setPlayerApi",(t=>{const{onMuteChange:e,customOverlay:i,onSetPlayerApi:s}=this.props;"function"==typeof i&&(this._playerInternal=t,this.forceUpdate()),e&&(t.on("unmute",(()=>e({isPlayerMuted:!1}))),t.on("mute",(()=>e({isPlayerMuted:!0})))),t&&(t.on("fullscreenEntered",(()=>this._handleFullscreenChange({isPlayerFullscreen:!0}))),t.on("fullscreenExited",(()=>this._handleFullscreenChange({isPlayerFullscreen:!1})))),this._setPlayerInternal(t),s&&s(t)})),n()(this,"_getPlayerCTA",(()=>{const{cta:t,promotedContent:e}=this.props;return t&&{...t,url:Object(x.a)(this.context.featureSwitches,t.url,null==e?void 0:e.click_tracking_info)}})),n()(this,"_handleApiReady",this._setPlayerApi),n()(this,"_getLoopingThreshold",(()=>{const{loopingThresholdMs:t,source:{videoId:e}}=this.props;return t||"tweet"===e.type&&6e4||7e3})),n()(this,"_handleAutoPlayRequest",(()=>{const{onAutoplay:t,shouldAutoplayWithoutMuting:e,isFleet:i}=this.props;!i&&this._playerInternal&&(e?this._playerInternal.play():this._playerInternal.playPreview(),t&&t())})),n()(this,"_handlePauseRequest",(()=>{const{onAutopause:t}=this.props;this._playerInternal&&(this._playerInternal.pause(),t&&t())})),n()(this,"_handlePlacementChange",(t=>{this._emitter&&!this._isPlayerFullscreen&&this._emitter.signalPlacementChange(t),this._playerInternal&&!this._isPlayerFullscreen&&this._playerInternal.updatePosition(t.getPositionData())})),n()(this,"_handlePlaybackComplete",(()=>{const{onPlaybackComplete:t}=this.props;this._emitter&&this._emitter.signalPlaybackFinish(),t&&t()})),n()(this,"_handlePlaybackStarted",(()=>{this._emitter&&this._emitter.signalPlay(),this.props.onPlaybackStarted&&this.props.onPlaybackStarted()})),n()(this,"_handlePlaybackPaused",(()=>{this._emitter&&this._emitter.signalPause()})),n()(this,"_handlePlayerState",(t=>{const{onPlayerState:e,onProgressChange:i}=this.props;e&&e(t);const s=(t.tracks||[]).find((e=>e.id===t.currentTrackId));if(s){const e=(s.currentTimeMs||0)/s.durationMs;i&&i(e,t.tracksFinished)}})),n()(this,"_handleError",(t=>{const{onError:e}=this.props,{error:i}=t;i?(this._emitter&&(this._emitter.unregister(),this._emitter=void 0,this._hasInitialPlacementMeasurement=!1,this._lastPlayerError=i),t.errorInfo&&!t.errorInfo.canRetry&&(e&&e(),this._onErrorUnsubscribe&&this._onErrorUnsubscribe())):!this._emitter&&this._lastPlayerError&&(this._registerPlaybackCoordination(),this._submitInitialPlacement(),this._lastPlayerError=void 0)})),n()(this,"_handleFullscreenChange",(t=>{const e=this.context.viewport;if(this._isPlayerFullscreen=t.isPlayerFullscreen,e){if(e.temporarilySuppressScrollListeners(2e3),L.b.isChrome()||L.b.isSafari())if(this._isPlayerFullscreen)this._savedScrollPosition={y:e.scrollY(),x:e.scrollX()};else if(this._savedScrollPosition){const{x:t,y:i}=this._savedScrollPosition;this._savedScrollPosition=void 0,e.scrollTo(t,i)}this._isPlayerFullscreen&&this._playerInternal?this._playerInternal.updatePosition({percentVisible:1,percentOfViewportOccupied:1,sizesInfo:{viewportSize:e.getRect2D(),mediaSize:e.getRect2D()}}):!this._isPlayerFullscreen&&this._placementRef&&this._placementRef.sample(this._handlePlacementChange)}const{onFullscreenChange:i}=this.props;i&&i(t),this._emitter&&this._emitter.signalFullscreenChange(t.isPlayerFullscreen)})),n()(this,"_registerPlaybackCoordination",(()=>{const{isFleet:t,playbackCoordination:e,playbackPriority:i}=this.props,s={onAutoPlayRequest:this._handleAutoPlayRequest,onPauseRequest:this._handlePauseRequest,canAutoplay:!t&&this._shouldAutoplay,isLooping:this._isLooping,playbackPriority:i};e&&(this._emitter=e.register(s))})),n()(this,"_setPlayerInternal",(t=>{if(this._playerInternal=t,t){const{onPlayerState:e,onProgressChange:i}=this.props;(e||i)&&t.subscribe(this._handlePlayerState),this._onErrorUnsubscribe=t.subscribe(this._handleError),t.on("playbackComplete",this._handlePlaybackComplete),t.on("play",this._handlePlaybackStarted),t.on("pause",this._handlePlaybackPaused),this._registerPlaybackCoordination(),this._submitInitialPlacement()}if(this.props.setPlayer){const t=this._playerInternal&&{play:()=>{this._playerInternal&&this._playerInternal.play()},pause:()=>{this._playerInternal&&this._playerInternal.pause()},replay:()=>{this._playerInternal&&this._playerInternal.replay()}};this.props.setPlayer(t)}})),n()(this,"_setPlacementAPI",(t=>{this._placementRef=t,this._submitInitialPlacement()})),n()(this,"_getTweetId",(()=>{const{source:{videoId:t}}=this.props;if(t){if("tweet"===t.type)return t.id;if("broadcast"===t.type)return t.tweetId}})),n()(this,"_tweetAdProvider",(t=>{const e=this._getTweetId();if(e)return()=>this.props.tweetAdProvider(e,t)}));const{autoplay:i,forwardPivotInfo:s}=t;this._disableHls=!(L.b.isDesktopOS()||L.b.isAndroid()&&this.context.featureSwitches.isTrue("web_video_hls_android_mse_enabled")),this._shouldAutoplay=Object(H.a)(i,s)}componentDidUpdate(t){const{heightsReady:e}=this.props;!t.heightsReady&&e&&this._submitInitialPlacement(),Object(C.a)(t.source,this.props.source)||this._emitter&&this._emitter.reset()}render(){const{aspectRatio:t}=this.props;return o.createElement(j.a,{ratio:t,style:J.aspectRatio},o.createElement(k,{onChange:this._handlePlacementChange,ref:this._setPlacementAPI,style:U.a.absoluteFill},this._renderPlayer()))}componentWillUnmount(){this._emitter&&(this._emitter.unregister(),this._emitter=null),this._onErrorUnsubscribe&&this._onErrorUnsubscribe()}_renderPlayer(){const{source:{variants:t},durationMs:e,forceLoop:i,videoType:s,isFleet:a,maxLoopCount:r,poster:n,promotedContent:l,dataSaverMode:c}=this.props,h="animated_gif"===s,p="vine"===s,d=t&&t.length?h?"gif":"media_entity":"vmap";this._isLooping=!!(i||h||p||e&&e<=this._getLoopingThreshold());const u={bitrateCap:c?v.a.MEDIUM:void 0,contentType:d,loop:!a&&this._isLooping,maxLoopCount:this._isLooping&&!a?r:void 0,poster:n&&n.url,promotedContext:l&&(l.impression_id||l.disclosure_type)?{impressionId:l.impression_id,disclosureType:l.disclosure_type}:void 0,variants:t&&Object(y.e)(Object(q.b)(t,c?q.a.MEDIUM:q.a.HIGH).map((t=>({src:t.url,type:t.content_type}))))||[]};return o.createElement(I.a,{testID:M},this._renderHorizonPlayer(u))}_submitInitialPlacement(){const{heightsReady:t}=this.props,e=t&&!this._hasInitialPlacementMeasurement;this._emitter&&this._placementRef&&e&&(this._placementRef.sample(this._handlePlacementChange),this._hasInitialPlacementMeasurement=!0)}}n()(B,"contextType",z.a),n()(B,"defaultProps",{autoplay:g.b.Off,playbackCoordination:O.b,playbackPriority:N.a.NORMAL,showControls:!0,dataSaverMode:!1,geolocationPrompt:!0,heightsReady:!0,noAuthHttpClient:X,includeBroadcastEventAssociation:!1});const J=U.a.create({aspectRatio:{zIndex:void 0}});var W=i("fs1G"),Y=i("64vW");class G extends o.PureComponent{constructor(t,e){super(t,e),n()(this,"_player",null),n()(this,"_getBaseItem",(t=>{const{analytics:e,includeBroadcastEventAssociation:i,source:{videoId:s}}=this.props,{event_id:a}=e.contextualScribeData;let r;return r="broadcast"===s.type&&s.tweetId?s.tweetId:"broadcast"===s.type&&i&&a?a:s.id,t.find((t=>t.id===r))})),n()(this,"_createAnalytics",(t=>{const e={log:this._scribeAction},{analytics:i}=this.props,s={log:this.context.featureSwitches.isTrue("responsive_web_video_promoted_logging_enabled")?this._logPromotedVideoEvent:W.a},a=i.contextualScribeNamespace,r=i.contextualScribeData,n={scribeContext:{...a},baseScribeItem:Array.isArray(r.items)?this._getBaseItem(r.items):void 0,enableShortFormCompleteLogging:this.context.featureSwitches.isTrue("responsive_web_video_pcomplete_enabled")};return new D.a(e,s,t,n)})),n()(this,"_logPromotedVideoEvent",(t=>{const{createLocalApiErrorHandler:e}=this.props;this.props.logPromotedVideoEvent(t).catch(e())})),n()(this,"_scribeAction",(t=>{const{category:e,data:i,namespace:s}=t,{analytics:a}=this.props;null!=s&&s.action&&a.scribe({...s,data:{...i,_category_:e}})})),n()(this,"_setPlayer",(t=>{if(this._player=t,this.props.setPlayer){const t=this._player&&{play:()=>{this._player&&this._player.play()},pause:()=>{this._player&&this._player.pause()},replay:()=>{this._player&&this._player.replay()}};this.props.setPlayer(t)}})),this._twitterAuthedHttpClient=t.getTwitterAuthedHttpClient(),this._analytics=this._createAnalytics(this._twitterAuthedHttpClient)}render(){const{createLocalApiErrorHandler:t,getTwitterAuthedHttpClient:e,tweetAdProvider:i,...s}=this.props;return o.createElement(Y.a.Consumer,null,(({heightsReady:t})=>o.createElement(B,a()({},s,{analytics:this._analytics,heightsReady:t,setPlayer:this._setPlayer,tweetAdProvider:i,twitterAuthedHttpClient:this._twitterAuthedHttpClient}))))}}n()(G,"contextType",z.a);const Z=P(G);e.default=Z}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/ondemand.InlinePlayer.038e18a5.js.map